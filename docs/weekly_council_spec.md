# Weekly Council Pipeline êµ¬í˜„ ì§€ì¹¨ì„œ (v1.1)

## 1. ê°œìš” ë° ëª©ì 
**ëª©ì :** "ì£¼ê°„(Weekly) ë¡œì»¬ LLM ì‚°ì¶œë¬¼ â†’ 1:3(ì œë‹ˆ/ë¯¼ì§€/ì¤€í˜¸) API ë¦¬ë·° â†’ íŒ¨ì¹˜ ë²ˆë“¤ ìƒì„±/ì ìš©" íŒŒì´í”„ë¼ì¸.
**ë³€ê²½ ì‚¬ìœ  (v1.1):** ë§¤ì¼ ì½”ë“œ ìˆ˜ì •ì€ ê³¼ë„í•˜ë©°, ì£¼ê°„ ë‹¨ìœ„ ë¦¬ë·°ê°€ ë” ì•ˆì •ì ì´ê³  ì˜ë¯¸ ìˆëŠ” íŒ¨í„´ ë„ì¶œì— ì í•©í•¨.
**í•µì‹¬ ê°€ì¹˜:** Human-in-the-Loop ê¸°ë°˜ì˜ ì•ˆì „í•˜ê³  íˆ¬ëª…í•œ ì˜ì‚¬ê²°ì • ìë™í™”.

## 2. 5ëŒ€ í•µì‹¬ ì›ì¹™ (Critical Principles)
1. **"daily_packetì€ ì›ì²œ ë¡œê·¸ë¥¼ ë¤í”„í•˜ì§€ ì•Šìœ¼ë©°, ëŒ€í‘œ ì¼€ì´ìŠ¤ 6~10ê°œë§Œ í¬í•¨í•œë‹¤."**
2. **"ì™¸ë¶€ APIë¡œ ì „ì†¡ë˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” ë¯¼ê°ì •ë³´ allowlist ê¸°ë°˜ìœ¼ë¡œ ì¶”ì¶œí•œë‹¤."**
3. **"ë¦¬ë·° ì‘ë‹µì€ JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦ì„ í†µê³¼í•´ì•¼ í•˜ë©°, ì‹¤íŒ¨ ì‹œ 1íšŒ ì¬ìš”ì²­ í›„ ì¤‘ë‹¨í•œë‹¤."**
4. **"patch_bundle ìë™ ì ìš©ì€ ì•ˆì „ ë²”ìœ„(ìŠ¤í‚¤ë§ˆ/í”„ë¡¬í”„íŠ¸/ë£°/í…ŒìŠ¤íŠ¸)ë¡œ ì œí•œí•˜ê³ , í•µì‹¬ ì‹¤í–‰ ë¡œì§ì€ ê¸ˆì§€í•œë‹¤."**
5. **"confidence ìµœì¢… ì‚°ìˆ˜ëŠ” ì½”ë“œì—ì„œ ìˆ˜í–‰í•˜ë©° ëª¨ë¸ì—ê²Œ ì‚°ìˆ˜ë¥¼ ë§¡ê¸°ì§€ ì•ŠëŠ”ë‹¤."**

## 3. ì‹œìŠ¤í…œ êµ¬ì„±

### A. Team Structure (1:3 Human-AI Team)
- **Local:** Qwen-3 (32B) - ì¼ì¼ ì‹¤í–‰ ë° ì œì•ˆ ìƒì„± (Execution)
- **Council (API):**
  - **Jennie (Gemini):** ê°œì„ ì•ˆ ì œì•ˆ, ì‹¤í—˜ ì„¤ê³„ (Acceleration)
  - **Minji (Claude):** ë¦¬ìŠ¤í¬ ê²€í† , Veto í–‰ì‚¬ (Guardrails)
  - **Junho (GPT):** ì˜ê²¬ ì¢…í•©, ìµœì¢… ì˜ì‚¬ê²°ì • (Moderator)

### B. Directory Structure
```
runs/
  YYYY-Www/                    # Weekly (e.g., 2025-W51)
    weekly_packet.json         # Council ì…ë ¥ (ì£¼ê°„ ëŒ€í‘œ ì¼€ì´ìŠ¤)
reviews/
  YYYY-Www/
    junho_review.json          # Junhoì˜ ì „ëµ ë¶„ì„
    patch_bundle.json          # ìµœì¢… ì‚°ì¶œë¬¼
    errors/                    # ì‹¤íŒ¨ ë¡œê·¸
schemas/                       # JSON Schemas
prompts/ council/              # System Prompts
scripts/
  build_weekly_packet.py       # Local -> Packet (ì£¼ê°„ ë°ì´í„° ì§‘ê³„)
  run_weekly_council.py        # Packet -> Council -> Bundle
  apply_patch_bundle.py        # Bundle -> Codebase (ë³€ê²½ ì—†ìŒ)
```

## 4. ìƒì„¸ êµ¬í˜„ ëª…ì„¸

### (1) Weekly Packet Generator (`build_weekly_packet.py`)
- **Sampling Logic:** ì£¼ê°„(5 ê±°ë˜ì¼) ë¡œê·¸ ì¤‘ ì´ 10~15ê°œ ì¼€ì´ìŠ¤ ì¶”ì¶œ.
  - Veto ì¼€ì´ìŠ¤: 3~4ê°œ
  - Rule ìœ„ë°˜/ê°­: 3~4ê°œ
  - ì„±ê³¼ ìµœì•…: 2ê°œ
  - ì„±ê³¼ ìµœê³ : 2ê°œ
  - ì¼ë°˜ ìƒ˜í”Œ: 2~3ê°œ
- **Security:** ë¯¼ê°ì •ë³´(Key, ê³„ì¢Œ ë“±)ëŠ” ë§ˆìŠ¤í‚¹ ì²˜ë¦¬. `allowlist`ì— ì •ì˜ëœ í•„ë“œë§Œ í¬í•¨.
- **Output:** `summary_stats` (ì´ veto ìˆ˜, ì£¼ê°„ ìŠ¹ë¥ , í‰ê·  ìˆ˜ìµë¥  ë“±) í¬í•¨ í•„ìˆ˜.

### (2) Weekly Council Runner (`run_weekly_council.py`)
- **Schedule:** ë§¤ì£¼ ê¸ˆìš”ì¼ ì¥ ë§ˆê° í›„ (ê¶Œì¥: 18:00 KST)
- **Process:** Junho (GPT) ë‹¨ë… ì‹¤í–‰ (v1.1 ê°„ì†Œí™”).
  - v1.0ì˜ Jennie->Minji->Junho 3ë‹¨ê³„ëŠ” ê³¼ë„í–ˆìŒ. Junhoê°€ ì¢…í•© ë¦¬ë·° ë‹´ë‹¹.
- **Reliability:**
  - JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦ í•„ìˆ˜.
  - ì‹¤íŒ¨ ì‹œ 1íšŒ ì¬ì‹œë„ (Retry). 2íšŒ ì‹¤íŒ¨ ì‹œ í•´ë‹¹ ë‹¨ê³„ ì¤‘ë‹¨.
  - API Rate Limit (429) / Timeout ë°œìƒ ì‹œ Backoff ì •ì±… ì ìš©.

### (3) Patch Applicator (`apply_patch_bundle.py`)
- **Safety Gate:**
  - ê¸°ë³¸ ì‹¤í–‰ì€ `--dry-run` (ë³€ê²½ ì‚¬í•­ ì¶œë ¥ë§Œ ìˆ˜í–‰).
  - `--apply` ì˜µì…˜ ëª…ì‹œ ì‹œì—ë§Œ ì‹¤ì œ ì ìš©.
- **Allowed Targets:**
  - í—ˆìš©: `schemas/`, `prompts/`, `rules/`, `tests/`
  - ê¸ˆì§€: Core Logic (`main.py`, `execution_engine.py` ë“±), Secrets
- **Safety Mechanism:**
  - ì ìš© ì „ Git Branch ìƒì„± ë˜ëŠ” ë°±ì—….
  - ì ìš© í›„ Smoke Test ì‹¤íŒ¨ ì‹œ ìë™ Rollback.

## 5. í…ŒìŠ¤íŒ… ê³„íš
- **Unit Test:** `test_schema_validation.py` (ìŠ¤í‚¤ë§ˆ ì •í•©ì„±)
- **Smoke Test:** `test_pipeline_smoke.py` (Dummy Data ê¸°ë°˜ E2E íŒŒì´í”„ë¼ì¸ ê´€í†µ í…ŒìŠ¤íŠ¸)

---

## ğŸ“œ ë³€ê²½ ì´ë ¥ (Change History)

### v1.0 â†’ v1.1 (2025-12-20)
**Daily Council â†’ Weekly Council ì „í™˜**

| ë³€ê²½ì  | ì‚¬ìœ  |
|---|---|
| ì‹¤í–‰ ì£¼ê¸°: ë§¤ì¼ â†’ ë§¤ì£¼ ê¸ˆìš”ì¼ | ë§¤ì¼ ì½”ë“œ ìˆ˜ì •ì€ ê³¼ë„í•¨. ì£¼ê°„ ë‹¨ìœ„ê°€ ë” ì˜ë¯¸ ìˆëŠ” íŒ¨í„´ ë„ì¶œì— ì í•©. |
| 3í˜„ì ìˆœì°¨ í˜¸ì¶œ â†’ Junho ë‹¨ë… | Jennieâ†’Minjiâ†’Junho íŒŒì´í”„ë¼ì¸ì€ ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§. Junhoê°€ ì¢…í•© ë¦¬ë·° ë‹´ë‹¹. |
| ë””ë ‰í† ë¦¬: `YYYY-MM-DD` â†’ `YYYY-Www` | ISO ì£¼ì°¨ ê¸°ë°˜ ê´€ë¦¬ë¡œ ë³€ê²½. |

---

### guardrails.yaml íˆìŠ¤í† ë¦¬

**ì›ë˜ ëª©ì :**  
Daily Council v1.0 ì„¤ê³„ ë‹¹ì‹œ, **LLMì´ ìƒì„±í•œ ì½”ë“œ íŒ¨ì¹˜ë¥¼ ìë™ ë°°í¬**í•˜ëŠ” ê²ƒê¹Œì§€ ê³ ë ¤í–ˆì—ˆìŒ.  
â†’ "AIê°€ ì•Œì•„ì„œ ì½”ë“œ ìˆ˜ì • + ë°°í¬"ê°€ ê°€ëŠ¥í•´ì§€ë©´, **í• ë£¨ì‹œë„¤ì´ì…˜ìœ¼ë¡œ ì¸í•œ ë²„ê·¸ ë°°í¬ ì‹œ** ì‹œìŠ¤í…œì´ í­ì£¼í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **ëŸ°íƒ€ì„ ì•ˆì „ì¥ì¹˜(Kill Switch, Rollback)**ê°€ í•„ìˆ˜ë¼ê³  íŒë‹¨.  
â†’ `guardrails.yaml`ì— ìƒì„¸ ê·œì¹™(R001~R104)ì„ ì •ì˜í•¨.

**í˜„ì¬ ìƒíƒœ:**  
- v1.1ì—ì„œ **ìˆ˜ë™ ë°°í¬(Human-in-the-Loop)**ë¡œ ì „í™˜ë¨.  
- `apply_patch_bundle.py`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `--dry-run`ì´ë©°, ì‚¬ëŒì´ `--apply`ë¥¼ ëª…ì‹œí•´ì•¼ë§Œ ì ìš©.  
- ë”°ë¼ì„œ **guardrails.yamlì€ ë‹¹ì¥ í•„ìš” ì—†ìŒ**.

**íŒŒì¼ ìœ„ì¹˜:**  
- ì‚­ì œí•˜ì§€ ì•Šê³  `docs/design_drafts/guardrails.yaml`ë¡œ ì´ë™í•¨.  
- í–¥í›„ **Full Automation(ë¬´ì¸ ë°°í¬)** ì „í™˜ ì‹œ ì´ íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ `guardrails_engine.py` êµ¬í˜„ ì˜ˆì •.
