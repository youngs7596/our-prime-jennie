# Prime Council Report
- Date: 2026-02-04 21:45:47
- Query: Review this intraday implementation plan
- Target: /home/youngs75/.gemini/antigravity/brain/64cb4ab2-f93f-4f3c-a534-1ab19966b50c/implementation_plan.md

# Final Plan: Intraday Data Integration Plan

## 1) 승인된 범위 (Approved scope)
- Smart Scouter, Micro-Timing, Dynamic ATR 세 기능 모두 포함. 단, 구현 전 아래의 지적사항에 대한 명확한 해결이 필수:
  - "Bearish Engulfing" 정의
  - 데이터 신뢰성
  - 파라미터 튜닝

## 2) 실행 순서가 있는 액션 스텝 (Action Steps)
1. **"Bearish Engulfing" 정의 추가**  
   - `services/buy-executor/executor.py`의 `validate_entry_timing` 함수에 명확하고 정량적인 정의를 추가하고 문서화.
  
2. **데이터 신뢰성 모니터링 구축**  
   - `collect_minute_chart` DAG의 데이터 지연 및 완전성에 대한 실시간 모니터링 시스템 구축.
  
3. **볼륨 조건 백테스트 수행**  
   - `services/scout-job/scout.py`의 `check_intraday_momentum`에서 볼륨 조건을 150% 또는 180%로 완화했을 때의 백테스트 시뮬레이션 수행.
  
4. **파라미터 튜닝 및 검증**  
   - Smart Scouter와 Buy Executor의 파라미터에 대한 백테스트를 수행하여 최적의 값을 결정.
  
5. **기능 간 상호작용 테스트**  
   - 세 기능이 함께 작동할 때의 시나리오를 검증하여 상호작용 복잡성을 평가.
  
6. **자동화된 테스트 계획 수립**  
   - 현재의 검증 계획을 자동화하여 프로덕션 배포 후 문제 발견 가능성을 줄임.
  
7. **롤백 및 페일세이프 전략 수립**  
   - 각 기능의 오작동 시 롤백 및 페일세이프 전략을 수립하여 전체 거래 파이프라인에 미치는 영향을 최소화.

## 3) 실험 및 수용 기준 (Experiments & Acceptance criteria)
- **실험 1: 볼륨 조건 최적화**
  - **가설**: 200% 조건은 너무 엄격하여 150~180%에서 더 나은 수익성.
  - **수용 기준**: 180% 그룹에서 200% 그룹 대비 스카우트 종목 수 +20%, 평균 수익률 +3% 이상.

- **실험 2: Micro-Timing 효과 측정**
  - **가설**: "Shooting Star" 및 "Bearish Engulfing" 거절이 손실을 줄임.
  - **수용 기준**: 거절 로직 ON 그룹에서 손실 거래 -15% 이상.

- **실험 3: ATR 윈도우 최적화**
  - **가설**: window=20은 변동성이 큰 시장에서 스탑을 너무 타이트하게 설정.
  - **수용 기준**: window=30 그룹에서 손절 빈도 -10%, P&L +2% 이상.

## 4) 리스크 및 롤백 트리거 (Risk & rollback triggers)
- **리스크**
  - "Bearish Engulfing" 정의 부재로 인한 예측 불가능한 매수 거절.
  - 데이터 지연/누락으로 인한 모든 인트라데이 로직의 오작동.
  - 과도한 필터링으로 인한 초기 모멘텀 기회 손실.
  - 타이트한 ATR 스탑으로 인한 잦은 손절.
  - 테스트 자동화 부재로 인한 프로덕션 배포 후 문제 발견 가능성 증가.

- **롤백 트리거**
  - "Bearish Engulfing" 정의 없이 배포될 경우.
  - `collect_minute_chart` DAG의 데이터 신뢰성이 99% 미만으로 떨어질 경우.
  - 자동화된 백테스트 결과 없이 파라미터가 확정될 경우.

## Notes
- 제니와 민지의 의견은 위의 리스크 및 액션 스텝에 반영되었습니다.

---
## Appendix: Raw JSON Outputs
<details><summary>Click to expand</summary>

### Jennie
```json
{
  "text": "## Verdict\n- decision: approve_with_changes\n- confidence: 90\n- scope: Intraday Data Integration Plan (Smart Scouter, Micro-Timing, Dynamic ATR)\n\n## Key Findings (<=5)\n1.  **Undefined \"Bearish Engulfing\" Condition**: `services/buy-executor/executor.py`의 `validate_entry_timing` 함수 내 \"Bearish Engulfing\" 거절 조건에 대한 명확한 정의가 없어, 해당 로직의 일관성과 신뢰성을 평가하기 어렵습니다. 이는 예측 불가능한 매수 거절로 이어질 수 있습니다.\n2.  **Potential for Overly Strict Momentum Filtering**: `services/scout-job/scout.py`의 `check_intraday_momentum`에서 \"Average volume of last 3 bars > 200% of previous 3 bars\" 조건은 초기 모멘텀 기회를 과도하게 필터링하여 놓칠 가능성이 있습니다.\n3.  **Risk of Whipsaws with Dynamic ATR**: `shared/position_sizing.py`의 `calculate_intraday_atr`는 변동성이 높은 시장에서 스탑 로스를 지나치게 타이트하게 설정하여, 유효한 포지션에서도 잦은 손절을 유발할 수 있습니다.\n4.  **Critical Data Freshness Dependency**: 모든 인트라데이 로직은 `STOCK_MINUTE_PRICE` 데이터의 실시간성과 정확성에 크게 의존합니다. 데이터 지연이나 불완전한 바(bar)는 잘못된 의사결정으로 이어질 수 있습니다.\n\n## Evidence\n- references:\n    - `/home/youngs75/.gemini/antigravity/brain/64cb4ab2-f93f-4f3c-a534-1ab19966b50c/implementation_plan.md` (전체 문서)\n    - `services/scout-job/scout.py` (Smart Scouter 로직)\n    - `services/buy-executor/executor.py` (Buy Executor Refinement 로직)\n    - `shared/position_sizing.py` (Dynamic ATR 로직)\n    - `STOCK_MINUTE_PRICE` table (핵심 데이터 의존성)\n    - `collect_minute_chart` DAG (데이터 수집 파이프라인)\n- missing_data:\n    - `services/buy-executor/executor.py`의 `validate_entry_timing` 함수 내 \"Bearish Engulfing\" 패턴에 대한 명확한 정의 및 계산 로직: 이 조건이 어떻게 구현될지 알 수 없어, 해당 기능의 신뢰성을 평가하기 어렵습니다.\n    - 각 기능이 특정 시장 국면(예: 추세장, 횡보장, 급락장)에서 어떻게 작동할지에 대한 예상 시나리오 및 백테스트 결과: 현재 계획만으로는 특정 국면에서의 성능 저하 가능성을 예측하기 어렵습니다.\n\n## Risks & Veto Triggers\n- risks:\n    - **False Negatives in Scouting**: 과도하게 엄격한 모멘텀 조건으로 인해 유망한 초기 상승 종목을 놓칠 수 있습니다.\n    - **Premature Order Rejections**: 마이크로 타이밍 로직이 단기적인 노이즈에 과민 반응하여 유효한 매수 기회를 불필요하게 지연시키거나 취소할 수 있습니다. 특히 \"Bearish Engulfing\" 조건이 모호하여 예측 불가능한 거절이 발생할 수 있습니다.\n    - **Whipsaw Losses**: 동적 ATR이 지나치게 타이트한 스탑 로스를 유발하여, 변동성이 크지만 추세가 유지되는 시장에서 잦은 손절매로 인한 손실이 발생할 수 있습니다.\n    - **Data Integrity Issues**: `STOCK_MINUTE_PRICE` 데이터의 지연, 누락, 또는 부정확성은 모든 인트라데이 로직의 오작동을 초래할 수 있습니다.\n- veto_if:\n    - `services/buy-executor/executor.py`의 \"Bearish Engulfing\" 조건이 명확하게 정의되지 않고 배포될 경우.\n    - `collect_minute_chart` DAG의 데이터 수집 신뢰성이 99% 미만으로 떨어지거나, 데이터 지연이 1분 이상 지속적으로 발생할 경우.\n\n## Recommendations\n- immediate_actions:\n    1.  `services/buy-executor/executor.py` 내 `validate_entry_timing` 함수에서 \"Bearish Engulfing\" 패턴에 대한 명확하고 정량적인 정의(예: 이전 바 대비 종가 하락률, 거래량 증가 조건 등)를 추가하고, 이를 문서화하세요.\n    2.  `collect_minute_chart` DAG의 데이터 수집 지연 및 완전성(completeness)에 대한 실시간 모니터링 및 알림 시스템을 구축하고, 관련 메트릭을 대시보드에 추가하세요.\n    3.  `services/scout-job/scout.py`의 `check_intraday_momentum`에서 현재 200%인 볼륨 조건을 150% 또는 180%로 완화했을 때의 백테스트 시뮬레이션을 우선적으로 수행하여, 놓치는 기회 비용을 정량화하세요.\n- experiments:\n    - **Hypothesis**: `services/scout-job/scout.py`의 200% 볼륨 조건은 너무 엄격하여 유망한 초기 모멘텀 종목을 놓치고 있다.\n        - **Method**: `check_intraday_momentum`에서 볼륨 조건 임계값을 150%, 180%, 200%로 변경하여 각각의 스카우트 결과(종목 수, 평균 수익률, 최대 드로다운)를 비교하는 백테스트를 수행합니다.\n        - **Success Metrics**: 150% 또는 180% 임계값에서 200% 임계값 대비 스카우트된 종목 수가 20% 이상 증가하고, 평균 수익률은 5% 이상 개선되면서 최대 드로다운은 10% 이내로 유지되는 경우.\n    - **Hypothesis**: `services/buy-executor/executor.py`의 \"Shooting Star\" 및 \"Bearish Engulfing\" (정의 후) 거절 로직은 유효한 매수 기회를 과도하게 차단하여 수익성을 저해한다.\n        - **Method**: 거절 로직을 적용했을 때와 적용하지 않았을 때의 매수 시점 이후 15분, 30분, 60분 수익률을 비교하는 시뮬레이션을 수행합니다. 특히 거절된 종목들이 이후 어떻게 움직였는지 분석합니다.\n        - **Success Metrics**: 거절 로직을 적용하지 않았을 때의 평균 수익률이 5% 이상 높고, 거절된 종목 중 30% 이상이 30분 이내에 유의미한 상승(예: 2% 이상)을 보인다면, 거절 로직의 완화 또는 재검토가 필요합니다.\n    - **Hypothesis**: `shared/position_sizing.py`의 `calculate_intraday_atr` (window=20)는 변동성이 큰 시장에서 스탑 로스를 지나치게 타이트하게 설정하여 잦은 손절을 유발한다.\n        - **Method**: `window` 값을 10, 20, 30, 40으로 변경하여 각각의 스탑 로스 트리거 빈도, 평균 손실 규모, 최종 P&L을 비교하는 백테스트를 수행합니다. 또한, 일간 ATR과 인트라데이 ATR을 혼합(예: 50:50)하여 사용하는 방식도 함께 테스트합니다.\n        - **Success Metrics**: `window` 값이 30 이상일 때 손절 빈도가 10% 이상 감소하고, 최종 P&L이 3% 이상 개선되면서 최대 드로다운은 5% 이내로 유지되는 경우.\n- if_code_change_needed:\n    - `services/buy-executor/executor.py`: \"Bearish Engulfing\" 패턴 정의 및 로직 추가.\n    - `services/scout-job/scout.py`: `check_intraday_momentum`의 볼륨 조건 임계값 조정.\n    - `shared/position_sizing.py`: `calculate_stop_loss`에서 `intraday_atr`의 `window` 파라미터 또는 가중치 조정.\n\n## Questions to the User\n- \"Bearish Engulfing\" 패턴에 대해 현재 팀에서 생각하는 구체적인 정의(예: 이전 바 대비 종가 하락률, 거래량 조건 등)가 있습니까?\n- `collect_minute_chart` DAG의 현재 평균 데이터 지연 시간 및 데이터 완전성(missing bars) 메트릭은 어느 정도입니까?\n- 인트라데이 모멘텀 스카우터(Feature 1)가 특정 시장 국면(예: 박스권, 하락장)에서 어떻게 작동할 것으로 예상하며, 이에 대한 방어 로직이 고려되었습니까?",
  "decision": "neutral",
  "raw_output": true
}
```
### Minji
```json
{
  "text": "# Council Output: Intraday Data Integration Plan Review\n\n## Verdict\n- **decision**: approve_with_changes\n- **confidence**: 75\n- **scope**: Smart Scouter, Micro-Timing, Dynamic ATR 세 기능 모두 포함. 단, 구현 전 Jennie의 지적사항(Bearish Engulfing 정의, 데이터 신뢰성, 파라미터 튜닝)에 대한 명확한 해결이 필수.\n\n---\n\n## Key Findings (<=5)\n\n1. **\"Bearish Engulfing\" 정의 부재 → 예측 불가능한 거절 로직**\n   - `validate_entry_timing()`에서 \"Previous bar blocked by massive selling\"은 정량적 기준이 없음.\n   - 결과: 같은 패턴이 때로는 거절, 때로는 통과 → 거래 신뢰도 저하.\n\n2. **데이터 신뢰성이 모든 로직의 기초인데, 모니터링 계획 부재**\n   - `STOCK_MINUTE_PRICE` 테이블의 지연/누락/부정확성이 발생하면 세 기능 모두 오작동.\n   - 현재 계획에는 \"collect_minute_chart DAG 신뢰성 확인\" 수준의 추상적 언급만 있음.\n\n3. **파라미터 튜닝 근거 부족**\n   - 200% 볼륨 조건, 20-bar ATR window, Shooting Star의 \"Upper Wick > Body * 2\" 등이 왜 이 값인지 불명확.\n   - 백테스트 없이 배포 시 초기 성능 저하 위험.\n\n4. **롤백/페일세이프 전략 부재**\n   - 세 기능이 모두 활성화되면 상호작용 복잡도 증가 (Scouter → Executor → Risk).\n   - 한 기능의 오작동이 전체 거래 파이프라인에 영향.\n\n5. **테스트 계획이 수동/정성적**\n   - \"HTS 차트와 비교\", \"시뮬레이션\" 수준 → 자동화된 검증 부재.\n   - 프로덕션 배포 후 문제 발견 가능성 높음.\n\n---\n\n## Evidence\n\n### References\n- **파일**: `/home/youngs75/.gemini/antigravity/brain/64cb4ab2-f93f-4f3c-a534-1ab19966b50c/implementation_plan.md`\n- **핵심 의존성**:\n  - `services/scout-job/scout.py` → `check_intraday_momentum()`\n  - `services/buy-executor/executor.py` → `validate_entry_timing()`\n  - `shared/position_sizing.py` → `calculate_intraday_atr()`\n  - `STOCK_MINUTE_PRICE` 테이블 (데이터 소스)\n  - `collect_minute_chart` DAG (데이터 수집)\n\n### Missing Data\n- **Bearish Engulfing 정의**: 이전 바 대비 종가 하락률? 거래량 조건? 바디 크기 비율?\n- **데이터 SLA**: `collect_minute_chart` DAG의 평균 지연 시간, 데이터 완전성(missing bars %), 99th percentile latency.\n- **파라미터 근거**: 200%, 20-bar, 2x 값들의 백테스트 결과 또는 업계 표준 참고.\n- **상호작용 테스트**: 세 기능이 함께 작동할 때의 시나리오 (예: Scouter가 감지 → Executor가 거절 → Risk 조정).\n\n---\n\n## Risks & Veto Triggers\n\n### Risks\n| 위험 | 심각도 | 영향 |\n|------|--------|------|\n| **Bearish Engulfing 모호성** | 🔴 높음 | 거래 거절 로직이 일관성 없음 → 신뢰도 저하 |\n| **데이터 지연/누락** | 🔴 높음 | 모든 인트라데이 로직 오작동 → 손실 발생 |\n| **과도한 필터링 (200% 볼륨)** | 🟡 중간 | 유망 기회 놓침 → 수익성 저하 |\n| **타이트한 ATR 스탑** | 🟡 중간 | 변동성 큰 시장에서 잦은 손절 → 수익성 저하 |\n| **테스트 자동화 부재** | 🟡 중간 | 프로덕션 배포 후 버그 발견 → 긴급 롤백 필요 |\n| **기능 간 상호작용 미검증** | 🟡 중간 | 예상 밖의 거래 거절/지연 → 기회 손실 |\n\n### Veto Triggers\n- ❌ **Bearish Engulfing 정의 없이 배포**\n- ❌ **`collect_minute_chart` DAG의 데이터 신뢰성이 99% 미만**\n- ❌ **자동화된 백테스트 결과 없이 파라미터 확정**\n- ❌ **세 기능의 통합 테스트 시나리오 미실행**\n\n---\n\n## Recommendations\n\n### Immediate Actions (배포 전 필수)\n\n#### 1️⃣ **Bearish Engulfing 정의 & 코드화** (우선순위: 🔴 높음)\n**현황**: \"Previous bar blocked by massive selling\" → 정량적 기준 부재.\n\n**액션**:\n```\n파일: services/buy-executor/executor.py\n함수: validate_entry_timing(stock_code)\n\n변경 전:\n  - Reject Condition (Bearish Engulfing): Previous bar blocked by massive selling.\n\n변경 후 (예시):\n  def validate_entry_timing(stock_code):\n      latest_bar = fetch_latest_5min_bar(stock_code)\n      prev_bar = fetch_previous_5min_bar(stock_code)\n      \n      # Shooting Star 체크\n      if latest_bar.upper_wick > latest_bar.body * 2:\n          return {\"status\": \"REJECT\", \"reason\": \"SHOOTING_STAR\"}\n      \n      # Bearish Engulfing 체크 (정의 예시)\n      # 조건: (1) 이전 바 종가 > 현재 바 종가\n      #      (2) 이전 바 거래량 < 현재 바 거래량 * 1.5\n      #      (3) 현재 바 종가 < 이전 바 시가\n      if (prev_bar.close > latest_bar.close and\n          prev_bar.volume < latest_bar.volume * 1.5 and\n          latest_bar.close < prev_bar.open):\n          return {\"status\": \"REJECT\", \"reason\": \"BEARISH_ENGULFING\"}\n      \n      return {\"status\": \"ACCEPT\"}\n```\n\n**테스트**:\n- Unit Test: 알려진 Bearish Engulfing 패턴 5개 + 정상 패턴 5개로 검증.\n- 로그: 거절 사유를 명확히 기록 (SHOOTING_STAR vs BEARISH_ENGULFING).\n\n**롤백**: 조건을 주석 처리하고 `status=\"ACCEPT\"` 반환.\n\n---\n\n#### 2️⃣ **데이터 신뢰성 모니터링 구축** (우선순위: 🔴 높음)\n**현황**: DAG 신뢰성 확인 계획만 있고, 실시간 모니터링 없음.\n\n**액션**:\n```\n파일: (신규 또는 기존 모니터링 모듈)\n함수: monitor_minute_price_data()\n\n구현 항목:\n1. 데이터 지연 시간 (Latency):\n   - 최신 5분 바의 타임스탬프 vs 현재 시간 차이 측정.\n   - 임계값: 1분 이상 지연 시 알림.\n   \n2. 데이터 완전성 (Completeness):\n   - 지난 1시간 동안 예상되는 바 개수(12개) vs 실제 개수 비교.\n   - 누락률 > 5% 시 알림.\n   \n3. 메트릭 수집:\n   - Prometheus/CloudWatch에 `minute_price_latency_seconds`, `minute_price_completeness_pct` 기록.\n   - 대시보드에 실시간 표시.\n\n4. 자동 차단:\n   - 지연 > 2분 또는 누락률 > 10% 시, 인트라데이 기능 자동 비활성화.\n   - 알림 발송 (Slack/Email).\n```\n\n**테스트**:\n- Integration Test: `collect_minute_chart` DAG 실행 후 모니터링 메트릭 확인.\n- Chaos Test: 의도적으로 데이터 지연/누락 주입 → 자동 차단 동작 확인.\n\n**롤백**: 모니터링 비활성화 (기존 DAG는 계속 실행).\n\n---\n\n#### 3️⃣ **파라미터 백테스트 & 튜닝** (우선순위: 🟡 중간)\n**현황**: 200%, 20-bar, 2x 값의 근거 부재.\n\n**액션**:\n```\n파일: (신규 백테스트 스크립트)\n함수: backtest_intraday_parameters()\n\n테스트 항목:\n\nA. Smart Scouter 볼륨 조건:\n   - 임계값: 150%, 180%, 200%, 250%\n   - 측정: 스카우트된 종목 수, 평균 수익률 (15분/30분/60분), 최대 드로다운\n   - 기간: 지난 3개월 (변동성 다양한 기간 포함)\n   - 성공 기준: 180% 임계값에서 200% 대비 종목 수 +20%, 수익률 +5%, 드로다운 -10%\n\nB. Buy Executor Shooting Star 조건:\n   - Upper Wick 배수: 1.5x, 2.0x, 2.5x\n   - 측정: 거절된 주문 수, 거절 후 15분 수익률 (거절된 vs 통과된)\n   - 성공 기준: 2.0x에서 거절된 종목의 30% 이상이 30분 내 2% 이상 상승하면 조건 완화 필요\n\nC. Dynamic ATR 윈도우:\n   - window: 10, 20, 30, 40\n   - 측정: 손절 빈도, 평균 손실, 최종 P&L, 최대 드로다운\n   - 성공 기준: window=30에서 손절 빈도 -10%, P&L +3%, 드로다운 -5%\n```\n\n**테스트 실행**:\n```bash\n# 예시 명령어\npython backtest_intraday_parameters.py \\\n  --start_date 2024-01-01 \\\n  --end_date 2024-03-31 \\\n  --volume_thresholds 150,180,200,250 \\\n  --output_dir ./backtest_results\n```\n\n**결과 검토**: 팀 회의에서 결과 공유 → 파라미터 확정.\n\n**롤백**: 기존 파라미터로 복구.\n\n---\n\n### Experiments (배포 후 검증)\n\n#### Experiment 1: 볼륨 조건 최적화\n- **Hypothesis**: 200% 조건은 너무 엄격 → 150~180%에서 더 나은 수익성.\n- **Method**: \n  - 라이브 거래 중 `check_intraday_momentum`의 임계값을 A/B 테스트 (50% 트래픽 각각).\n  - 1주일 동안 스카우트 결과, 매수 후 수익률, 손실 빈도 기록.\n- **Success Metrics**:\n  - 180% 그룹: 200% 그룹 대비 스카우트 종목 +20%, 평균 수익률 +3% 이상.\n  - 손실 빈도 동일 수준 유지.\n\n#### Experiment 2: Micro-Timing 효과 측정\n- **Hypothesis**: Shooting Star/Bearish Engulfing 거절이 손실을 줄임.\n- **Method**:\n  - 거절 로직 ON/OFF 두 그룹으로 나누어 1주일 거래.\n  - 거절된 주문들이 이후 어떻게 움직였는지 추적.\n- **Success Metrics**:\n  - 거절 로직 ON 그룹: 손실 거래 -15% 이상.\n  - 거절된 주문 중 30% 이상이 30분 내 2% 이상 상승 (기회 손실 정량화).\n\n#### Experiment 3: ATR 윈도우 최적화\n- **Hypothesis**: window=20은 변동성 큰 시장에서 스탑을 너무 타이트하게 설정.\n- **Method**:\n  - window=20 vs window=30 두 그룹으로 1주일 거래.\n  - 손절 빈도, 평균 손실, 최종 P&L 비교.\n- **Success Metrics**:\n  - window=30 그룹: 손절 빈도 -10%, P&L +2% 이상.\n\n---\n\n### If Code Change Needed (구체적 diff)\n\n#### Change 1: Bearish Engulfing 정의 추가\n**파일**: `services/buy-executor/executor.py`  \n**함수**: `validate_entry_timing(stock_code)`  \n**범위**: 최소 (정의 추가만)\n\n```python\n# Before\ndef validate_entry_timing(stock_code):\n    latest_bar = fetch_latest_5min_bar(stock_code)\n    \n    # Reject Condition (Shooting Star)\n    if latest_bar.",
  "error": "JSON Parse Failed: Extra data: line 3 column 7 (char 61)",
  "raw_json_snippet": "{\"status\": \"REJECT\", \"reason\": \"SHOOTING_STAR\"}\n      \n      # Bearish Engulfing 체크 (정의 예시)\n      # 조건: (1) 이전 바 종가 > 현재 바 종가\n      #      (2) 이전 바 거래량 < 현재 바 거래량 * 1.5\n      #      (3) 현재 바 종가 < 이전 바"
}
```
### Junho
```json
{
  "text": "## Verdict\n- decision: approve_with_changes\n- confidence: 80\n- scope: Smart Scouter, Micro-Timing, Dynamic ATR 세 기능 모두 포함. 단, 구현 전 Jennie와 Minji의 지적사항에 대한 명확한 해결이 필수.\n\n## Key Findings (<=5)\n1. **\"Bearish Engulfing\" 정의 부재**: `validate_entry_timing()`에서 \"Previous bar blocked by massive selling\"은 정량적 기준이 없어, 해당 로직의 일관성과 신뢰성을 평가하기 어렵습니다.\n2. **데이터 신뢰성 문제**: `STOCK_MINUTE_PRICE` 테이블의 실시간성과 정확성에 크게 의존하며, 모니터링 계획이 부재하여 데이터 지연이나 누락 시 모든 기능이 오작동할 위험이 있습니다.\n3. **파라미터 튜닝 근거 부족**: 200% 볼륨 조건, 20-bar ATR window, Shooting Star의 \"Upper Wick > Body * 2\" 등의 기준이 명확하지 않아 초기 성능 저하 위험이 존재합니다.\n4. **롤백/페일세이프 전략 부재**: 세 기능이 모두 활성화되면 상호작용 복잡도가 증가하며, 한 기능의 오작동이 전체 거래 파이프라인에 영향을 미칠 수 있습니다.\n5. **테스트 계획의 자동화 부족**: 현재의 검증 계획은 수동적이며, 자동화된 검증이 없어서 프로덕션 배포 후 문제 발견 가능성이 높습니다.\n\n## Evidence\n- references:\n    - `/home/youngs75/.gemini/antigravity/brain/64cb4ab2-f93f-4f3c-a534-1ab19966b50c/implementation_plan.md`\n    - `services/scout-job/scout.py` (Smart Scouter 로직)\n    - `services/buy-executor/executor.py` (Buy Executor Refinement 로직)\n    - `shared/position_sizing.py` (Dynamic ATR 로직)\n    - `STOCK_MINUTE_PRICE` 테이블 (핵심 데이터 의존성)\n    - `collect_minute_chart` DAG (데이터 수집 파이프라인)\n- missing_data:\n    - \"Bearish Engulfing\" 패턴에 대한 명확한 정의 및 계산 로직.\n    - `collect_minute_chart` DAG의 평균 데이터 지연 시간 및 데이터 완전성 메트릭.\n    - 각 기능이 특정 시장 국면에서 어떻게 작동할지에 대한 예상 시나리오 및 백테스트 결과.\n\n## Risks & Veto Triggers\n- risks:\n    - **Bearish Engulfing 모호성**: 예측 불가능한 매수 거절로 이어질 수 있습니다.\n    - **데이터 지연/누락**: 모든 인트라데이 로직의 오작동을 초래할 수 있습니다.\n    - **과도한 필터링**: 초기 모멘텀 기회를 놓칠 위험이 있습니다.\n    - **타이트한 ATR 스탑**: 변동성이 큰 시장에서 잦은 손절을 유발할 수 있습니다.\n    - **테스트 자동화 부재**: 프로덕션 배포 후 버그 발견 가능성이 높습니다.\n- veto_if:\n    - \"Bearish Engulfing\" 정의 없이 배포될 경우.\n    - `collect_minute_chart` DAG의 데이터 신뢰성이 99% 미만으로 떨어질 경우.\n    - 자동화된 백테스트 결과 없이 파라미터가 확정될 경우.\n\n## Recommendations\n- immediate_actions:\n    1. `services/buy-executor/executor.py` 내 `validate_entry_timing` 함수에서 \"Bearish Engulfing\" 패턴에 대한 명확하고 정량적인 정의를 추가하고, 이를 문서화하세요.\n    2. `collect_minute_chart` DAG의 데이터 신뢰성 모니터링 시스템을 구축하고, 관련 메트릭을 대시보드에 추가하세요.\n    3. `services/scout-job/scout.py`의 `check_intraday_momentum`에서 현재 200%인 볼륨 조건을 150% 또는 180%로 완화했을 때의 백테스트 시뮬레이션을 수행하여, 놓치는 기회 비용을 정량화하세요.\n- experiments:\n    - **Hypothesis**: 200% 볼륨 조건은 너무 엄격하여 유망한 초기 모멘텀 종목을 놓치고 있다.\n        - **Method**: `check_intraday_momentum`에서 볼륨 조건 임계값을 150%, 180%, 200%로 변경하여 각각의 스카우트 결과를 비교하는 백테스트를 수행합니다.\n        - **Success Metrics**: 150% 또는 180% 임계값에서 200% 임계값 대비 스카우트된 종목 수가 20% 이상 증가하고, 평균 수익률이 5% 이상 개선되는 경우.\n    - **Hypothesis**: \"Shooting Star\" 및 \"Bearish Engulfing\" 거절 로직은 유효한 매수 기회를 과도하게 차단하여 수익성을 저해한다.\n        - **Method**: 거절 로직을 적용했을 때와 적용하지 않았을 때의 매수 시점 이후 수익률을 비교하는 시뮬레이션을 수행합니다.\n        - **Success Metrics**: 거절 로직을 적용하지 않았을 때의 평균 수익률이 5% 이상 높고, 거절된 종목 중 30% 이상이 30분 이내에 유의미한 상승을 보이는 경우.\n    - **Hypothesis**: `calculate_intraday_atr`는 변동성이 큰 시장에서 스탑 로스를 지나치게 타이트하게 설정하여 잦은 손절을 유발한다.\n        - **Method**: `window` 값을 10, 20, 30, 40으로 변경하여 각각의 스탑 로스 트리거 빈도, 평균 손실 규모, 최종 P&L을 비교하는 백테스트를 수행합니다.\n        - **Success Metrics**: `window` 값이 30 이상일 때 손절 빈도가 10% 이상 감소하고, 최종 P&L이 3% 이상 개선되는 경우.\n- if_code_change_needed:\n    - `services/buy-executor/executor.py`: \"Bearish Engulfing\" 패턴 정의 및 로직 추가.\n    - `services/scout-job/scout.py`: `check_intraday_momentum`의 볼륨 조건 임계값 조정.\n    - `shared/position_sizing.py`: `calculate_stop_loss`에서 `intraday_atr`의 `window` 파라미터 또는 가중치 조정.\n\n## Questions to the User (optional, <=3)\n- \"Bearish Engulfing\" 패턴에 대해 현재 팀에서 생각하는 구체적인 정의가 있습니까?\n- `collect_minute_chart` DAG의 현재 평균 데이터 지연 시간 및 데이터 완전성 메트릭은 어느 정도입니까?\n- 인트라데이 모멘텀 스카우터가 특정 시장 국면에서 어떻게 작동할 것으로 예상하며, 이에 대한 방어 로직이 고려되었습니까?",
  "decision": "neutral",
  "raw_output": true
}
```

</details>

---
## Cost Summary
| Model | Input | Output | Cost (USD) |
|-------|-------|--------|------------|
| Jennie (Gemini) | 0 | 0 | $0.0000 |
| Minji (Claude) | 3,041 | 2,160 | $0.2076 |
| Junho (OpenAI) | 0 | 0 | $0.0000 |
| Orchestrator (OpenAI) | 5,358 | 612 | $0.0012 |
| **Total** | - | - | **$0.2088** (≈303원) |
