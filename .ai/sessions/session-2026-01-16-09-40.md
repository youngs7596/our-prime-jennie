# Session Handoff: Buy-Scanner Modernization & Real-time Upgrade

## 요약 (Summary)
이번 세션에서는 `buy-scanner` 서비스를 대대적으로 리팩토링하여 기존의 폴링(Scheduler Job) 방식을 완전히 제거하고, **Redis Streams 기반의 순수 실시간 이벤트 구동 아키텍처**로 전환했습니다. 
또한, 사용자 요청에 따라 중요한 전략 로직인 **Legendary Pattern (골든크로스 + 외국인 수급 + RSI 과매도)** 감지 기능을 `scanner.py`에서 `BuyOpportunityWatcher`로 이관하여 실시간 스트림에서도 즉시 포착할 수 있도록 업그레이드했습니다.

## 변경 사항 (Changes)
- **`services/buy-scanner/main.py`**:
  - `SchedulerJobWorker` 및 관련 폴링 로직 삭제.
  - `/scan` (수동 트리거) 엔드포인트 및 legacy `_perform_scan` 함수 삭제.
  - `scanner.py` 의존성 제거 및 `BuyOpportunityWatcher` 단독 운영 체제 확립.
- **`services/buy-scanner/opportunity_watcher.py`**:
  - **Foreign Supply Data Integration**: `FactorRepository`를 통해 최근 30일 외국인 순매수 데이터를 로드하는 로직 추가 (`_load_supply_demand_data`).
  - **Legendary Pattern Integration**: `GOLDEN_CROSS` 발생 시 수급 및 RSI 조건을 추가 검증하여 `GOLDEN_CROSS_SUPER_PRIME` 신호로 격상하는 로직 구현.
  - RabbitMQ 발행 페이로드에 `is_super_prime` 필드 및 가산점 점수(520.0) 적용.
- **`services/buy-scanner/scanner.py`**:
  - 핵심 로직 이관 후 파일 삭제 (Code Cleanup).
- **`docs/changelogs/CHANGELOG-2026-01.md`**:
  - 2026-01-16 작업 내역 추가.
- **`docker-compose.yml`**:
  - (확인용) 볼륨 마운트가 없어 이미지 리빌드를 통해 배포 수행.

## 다음 단계 (Next Steps)
- [ ] **Price-Monitor Modernization**: `price-monitor` 서비스도 `buy-scanner`와 마찬가지로 레거시 폴링 로직이 남아있는지 확인하고, Redis Streams 전용으로 정리.
- [ ] **Sell Logic Enhancement**: 호황장(코스피 4800 등) 변동성에 대응하기 위해 매도 감시의 즉시성 및 무결성 재검토 (Redis Lock 등 기존 안전장치 점검).
- [ ] **Cleanup Shared Utils**: 더 이상 사용되지 않는 `shared/` 유틸리티 코드 발굴 및 삭제.
