# Session Handoff: Hunter 프롬프트 리밸런싱 & THINKING Tier Cloud 전환

**일시**: 2026-02-06 13:00 KST
**브랜치**: development
**커밋**: `472a0c6` Hunter 프롬프트 리밸런싱 & Scout THINKING tier Cloud 전환

## 변경 사항

### 1. Hunter 프롬프트 리밸런싱 (`shared/llm_prompts.py`)
이전 세션에서 수정했으나 **저장되지 않아** 다시 적용.

| 항목 | Before | After |
|------|--------|-------|
| 역할 | 엄격한 필터링 (Strict Gatekeeper) | 정확한 보정자 (Calibrator) |
| 톤 | 보수적인 투자 관점에서 엄격하게 | 객관적이고 균형 잡힌 관점에서 정확하게 |
| 비대칭 보정 | +10/-30 | +15/-20 |
| Moderate Positive | 없음 | +5~10 (신규 추가) |
| Neutral | +0 또는 -5 | ±0 (정량 점수 유지) |
| Critical | -20~30 | -15~20 |
| 경고문 | "점수를 후하게 주면 계좌가 녹습니다" | "근거 없이 가감점 금지, 뉴스 없으면 정량 유지" |

### 2. THINKING Tier Cloud 전환 (`docker-compose.yml`)
scout-job, scout-worker 모두에 추가:
```yaml
- TIER_THINKING_PROVIDER=ollama
- LOCAL_MODEL_THINKING=deepseek-v3.2:cloud
```

**주의**: docker-compose.yml 변경은 저장되었으나, **컨테이너 재시작 필요**. 현재 실행 중인 컨테이너에는 아직 미적용 상태.

## 12:00 KST Scout 실행 결과 (이전 프롬프트로 실행됨)

### Hunter Phase (76/76 완료)
- **평균: ~53.5점** (이전 10:30 실행 61.5점 대비 하락)
- **통과 (≥60): 19/76** (25%) - 10:30 실행 47/76 대비 크게 하락
- 최고: KB금융 77, 키움증권 74, 삼성생명 72

### Phase 2-3 Judge (진행중, 13/19 완료 시점)
- **Safety Lock 발생 2건**: KB금융 (77→33.8), 삼성생명 (72→33.4)
  - 원인: THINKING tier가 아직 로컬 Gateway 사용 → Gateway Circuit Breaker OPEN (vLLM 테스트 중)
- 나머지: Hunter < 70 → Judge Skip → Hunter 점수를 LLM 점수로 사용
- Ollama Cloud 503 에러 간헐적 발생 (Service Temporarily Unavailable)

### Hybrid 점수 분포 (13/19)
| 종목 | Hunter | Quant | LLM | Hybrid | 비고 |
|------|--------|-------|-----|--------|------|
| 영원무역홀딩스 | 65 | 80 | 65 | 73.9 | Judge Skip |
| 한국금융지주 | 64 | 74 | 64 | 70.0 | Judge Skip |
| CJ대한통운 | 65 | 73 | 65 | 70.0 | Judge Skip |
| GS | 60 | 75 | 60 | 69.3 | Judge Skip |
| 기업은행 | 63 | 73 | 63 | 68.7 | Judge Skip |
| SK스퀘어 | 62 | 72 | 62 | 68.0 | Judge Skip |
| 팬오션 | 62 | 72 | 62 | 67.8 | Judge Skip |
| 삼성카드 | 60 | 70 | 60 | 66.1 | Debate Error |
| 롯데쇼핑 | 60 | 70 | 60 | 65.9 | Judge Skip |
| DB손해보험 | 66 | 66 | 66 | 65.8 | Judge Skip |
| LG | 62 | 67 | 62 | 65.1 | Judge Skip |
| **KB금융** | **77** | 75 | **0** | **33.8** | **Safety Lock** |
| **삼성생명** | **72** | 74 | **0** | **33.4** | **Safety Lock** |

## 미해결 문제

### P0: 컨테이너 재시작 필요
docker-compose.yml에 THINKING tier 환경변수를 추가했지만, 컨테이너를 재시작해야 적용됨.
```bash
docker compose -p my-prime-jennie --profile real up -d --build scout-job scout-worker
```
**단, vLLM 테스트 완료 후 실행할 것** (현재 Ollama Gateway 사용 불가)

### P1: 프롬프트 효과 검증
수정된 프롬프트는 volume mount(`./shared:/app/shared`)로 다음 실행에서 자동 적용되나,
Python 모듈 캐싱으로 인해 **프로세스 재시작** 필요 (컨테이너 재시작 시 함께 해결).

### P2: Ollama Cloud 503 안정성
Cloud API가 간헐적 503 반환. Debate phase에서 주로 발생.
- 5회 재시도 후 로컬 Gateway 폴백 → Gateway도 실패 시 Debate Error
- 장기적으로 Cloud 안정성 모니터링 필요

### P3: Feedback 가이드라인 이중 페널티
`feedback_context`의 "단기 스나이퍼 점수가 15 이하인 종목은 절대 매수 금지" 가이드라인이
LLM에게 정량 점수에 이미 반영된 메트릭으로 이중 감점을 유도함.
- 예: 정량 75점 → LLM이 -25점 감점하여 50점으로 만듦 (과도한 보정)

## 시스템 아키텍처 참고

### Scout LLM Tier 구성 (목표 상태)
| Phase | Tier | Provider | Model | 비고 |
|-------|------|----------|-------|------|
| Hunter | REASONING | Ollama Cloud | deepseek-v3.2:cloud | 적용 중 |
| Debate | REASONING | Ollama Cloud | deepseek-v3.2:cloud | 적용 중 |
| Judge | THINKING | Ollama Cloud | deepseek-v3.2:cloud | **컨테이너 재시작 필요** |

### Volume Mount 동작
- `./shared:/app/shared` → 코드 변경은 즉시 반영 (단, Python import 캐시로 재시작 필요)
- 환경변수 변경 → 반드시 컨테이너 재시작/재생성 필요
