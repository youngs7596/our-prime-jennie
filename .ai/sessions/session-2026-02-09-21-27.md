# Session Handoff: Scout 워치리스트 매수불가 종목 사전 제거

## 요약 (Summary)
Hot watchlist에서 보유 중이거나 매도 쿨다운(24h) 중인 종목을 사전 제거하여,
MAX_WATCHLIST_SIZE(20) 슬롯을 효율적으로 활용하도록 개선.
기존에는 buy-executor에서 차단되던 종목이 워치리스트 슬롯을 낭비하고 있었음.

## 변경 사항 (Changes)
- `shared/db/repository.py`: `get_recently_traded_stocks_batch()`에 `trade_type` 파라미터 추가 (SELL 필터링 지원), 중복 실행 버그 수정 (333행 2회 호출 → 1회)
- `services/scout-job/scout.py`: 쿼터제 트렁케이션 직전에 매수불가 종목 사전 제거 필터 삽입 (보유 중 + 매도쿨다운 24h), `from shared.db import repository as repo` import 추가
- `tests/shared/db/test_repository.py`: `trade_type='SELL'`, `trade_type='BUY'` 필터링 테스트 2개 추가
- `tests/services/scout-job/test_scout_pipeline.py`: 매수불가 종목 사전 제거 로직 테스트 6개 추가 (보유 제거, 쿨다운 제거, 복합, 빈 입력, KOSPI 마커 보존, 슬롯 충원)

## 검증 결과
- Unit Test: 85/85 통과 (repository + scout-job)
- Shared Test: 1116/1116 통과 + 1 skipped
- 통합 검증 (실제 DB): 보유 9개, 매도쿨다운 6개 정상 조회, 필터링 로직 정상 동작 확인

## 다음 단계 (Next Steps)
- [ ] Docker 빌드 + 배포 (Jenkins 또는 수동): `docker compose --profile real up -d --build scout-job`
- [ ] 내일 장중 로그 모니터링: `docker logs my-prime-jennie-scout-job-1 -f | grep "매수불가"`
- [ ] 매수불가 제거 효과 확인: 워치리스트에 보유 종목이 포함되지 않는지 검증

## Context for Next Session
- `services/scout-job/scout.py`: 1243~1260행 (매수불가 필터 코드)
- `shared/db/repository.py`: 313~336행 (trade_type 파라미터)
- 롤백: `trade_type` 파라미터는 기본값 None이므로 기존 호출에 영향 없음. scout.py의 필터는 try/except로 감싸져 실패 시 기존 동작 유지.
