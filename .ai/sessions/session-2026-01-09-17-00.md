# Session Handoff: Combined Test Stabilization (Fixing NumPy Reload Crash)

## 요약 (Summary)
`tests/services/`와 `tests/shared/`를 함께 실행할 때 발생하던 `ImportError: numpy: cannot load module more than once` 에러를 해결했습니다.
원인은 `unittest.mock.patch.dict(sys.modules)`로 모듈 시스템을 격리하는 과정에서 C-Extension 모듈(`numpy`, `pandas`)이 언로드/재로드되었기 때문입니다.
이를 방지하기 위해 `tests/conftest.py`에서 테스트 시작 전에 이들을 미리 로드하여 전역 상태(Global State)에 고정시켰습니다.
또한, 테스트 파일들의 전역 `sys.modules` 오염(Global Pollution)을 바로잡고, 모킹(Mocking) 불일치 문제를 해결했습니다.

## 변경 사항 (Changes)
- `tests/conftest.py`: `pandas`, `numpy` import 구문 추가 (Pre-loading).
- `tests/services/buy-scanner/test_strategy_injection.py`: Top-level `sys.modules` 패치를 `setUp` 내부로 이동.
- `tests/services/price-monitor/test_dynamic_strategies.py`: Top-level `sys.modules` 패치를 `setUp` 내부로 이동.
- `tests/services/buy-scanner/test_scanner.py`: 격리된 모듈 로딩 (`importlib.util`) 적용.
- `tests/services/buy-executor/test_buy_executor.py`: `executor` 모듈 인스턴스의 속성을 `patch.object`로 직접 패치하여 Mock 불일치(`MagicMock` vs `int` Type Error) 해결.
- `rules.md`: **테스트 모범 사례 (Testing Best Practices)** 섹션 추가.
- `README.md`: 테스트 트러블슈팅 가이드 추가.

## 다음 단계 (Next Steps)
- [ ] Jenkins 파이프라인에서 전체 테스트(`tests/`) 실행 활성화 및 결과 확인.
- [ ] `skipping` 처리된 15개 테스트(알려진 이슈) 점검 및 수정.
- [ ] 새로운 기능 개발 복귀.
