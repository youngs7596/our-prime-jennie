# Session Handoff: Performance Dashboard Fixes & Logic Refinement

## 요약 (Summary)
이번 세션에서는 '투자 성과(Performance)' 대시보드에서 발생하던 404/500 오류를 모두 해결하고, 수익률 및 MDD(최대 낙폭) 계산 로직을 개선했습니다.
특히 초기 자본금 없이 수익금만으로 MDD를 계산하여 수치가 왜곡되던 문제(-80% 등)를 해결하기 위해 2억 원의 기준 자본금을 적용했습니다.
또한 KIS Gateway 호출 시 발생하던 `Connection reset` 오류에 대한 재시도 로직을 강화했습니다.

## 변경 사항 (Changes)
### Backend
- **`services/dashboard/backend/routers/performance.py`**: 라우터 Prefix 수정 (`/performance` → `/api/performance`)으로 404 오류 해결.
- **`services/dashboard/backend/main.py`**: `MarketRegime` 모델 누락으로 인한 500 오류 방지를 위한 임시 응답 처리.
- **`shared/analysis/performance_calculator.py`**:
  - `ActivePortfolio`의 잘못된 필드명 수정 (`avg_price` → `average_buy_price`).
  - 평가손익 계산 시 **실시간 현재가(`fetch_current_prices_from_kis`)** 연동.
  - MDD 계산 시 **초기 자본금(2억)**을 반영하여 Equity Curve 기준으로 변경.
- **`shared/db/repository.py`**: KIS API 호출 시 `Connection: close` 헤더 및 재시도(Retry) 로직 추가.

### Frontend
- **`services/dashboard/frontend/src/pages/Performance.tsx`**: API 호출 경로 수정.

## 다음 단계 (Next Steps)
- [ ] **일별 자산 스냅샷 시스템(Daily Asset Snapshot) 구축**:
  - 과거 거래 내역 역산 방식의 한계(수동매매/입출금 누락)를 극복하기 위해, 매일 잔고를 기록하는 `DAILY_ASSET_STATUS` 테이블 및 수집 봇 개발 필요.
- [ ] **Market Regime 기능 구현**: 현재 임시 스텁(Stub)으로 처리된 시장 국면 분석 로직 완성.
