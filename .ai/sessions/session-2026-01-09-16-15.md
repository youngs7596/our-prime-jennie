# Session Handoff: Debug Test Failures & Fix Mock Split-Brain

## 요약 (Summary)
주요 서비스(`buy-executor`, `sell-executor`, `buy-scanner`)의 단위 테스트에서 발생하는 `SQLAlchemy` 세션 오류, `ValueError`, `AssertionError`를 해결하기 위해 테스트 모듈의 Mocking 방식을 개선했습니다. 특히 `sys.modules`에 등록된 모듈(`shared.database`, `shared.db.repository`)과 테스트 대상 모듈이 참조하는 모듈 객체가 서로 달라 발생하는 "Split-Brain" 문제를 해결하기 위해, 모듈 로딩 시점 또는 `setUp` 단계에서 명시적인 Patching을 적용했습니다.

## 변경 사항 (Changes)
- `tests/services/sell-executor/test_sell_executor.py`: `executor_module` fixture에서 `shared.database`를 로딩 시점에 Patch하여 `executor.database` 참조가 Mock을 가리키도록 수정.
- `tests/services/buy-executor/test_buy_executor.py`: `load_executor_module` 함수에서 `shared.db.repository`, `shared.db.connection`을 Patch하여 안전장치 검사 시 Mock Repository가 사용되도록 보장.
- `tests/services/buy-scanner/test_scanner.py`: `setUp` 메서드에서 `scanner.session_scope`, `scanner.database`, `scanner.FactorRepository`를 직접 Patch (`patch.object` 패턴)하여 모듈 수준 import 참조를 Mock으로 교체.
- `services/buy-executor/executor.py`: 디버깅을 위해 추가했던 print 구문 제거.

## 다음 단계 (Next Steps)
- `test_redis_cache.py`의 `TypeError: metaclass conflict` 오류 (73 errors) 해결 필요 (redis_cache 관련 테스트 우선 점검).
- 수정된 테스트(`test_buy_executor.py`, `test_sell_executor.py`, `test_scanner.py`) 수행 및 Pass 확인 (이전 실패 196 errors 중 상당수 해결 예상).
- `test_monitor.py`, `test_repository.py` 등에 남아있는 `StopIteration` 및 `ValueError` 해결.
