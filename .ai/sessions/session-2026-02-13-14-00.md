# Session 2026-02-13 14:00 — Macro Council 섹터 모멘텀 + buy-scanner 전략 진단

## 완료된 작업

### 1. Macro Council에 네이버 섹터 모멘텀 데이터 주입
- `scripts/run_macro_council.py`: `_get_sector_momentum_text()` 헬퍼 추가
  - `get_naver_sector_list()` → 79개 세분류 등락률 수집
  - `NAVER_TO_GROUP` → 14개 대분류 집계 (단순 평균)
  - 상승 TOP 5 / 하락 TOP 5 + 대분류 집계 텍스트 생성
  - 예외 안전 (실패 시 빈 문자열)
- `_build_context_text()`에 `sector_momentum_text` 파라미터 추가
  - 글로벌 매크로 데이터 뒤, 정치 뉴스 앞에 배치
- `main()`에서 호출 및 전달
- 테스트: 기존 31개 + 신규 8개 = **39개 전체 통과**

### 2. KCC (002380) 고스트 매수 원인 규명
- cancel_order 버그(2026-02-13 수정)의 실제 피해 사례 확인
- buy-scanner가 09:26 KST MOMENTUM_CONTINUATION_BULL 시그널 발행
  - MA5(602,400) > MA20(588,700) + 당일 상승률 +7.0% + LLM 73.8
  - 09:27 확인 완료 → 매수 신호 발행 → buy-executor 지정가 주문 ~598,000원
  - cancel_order() AttributeError → TRADELOG 미기록, 텔레그램 미발송
  - KIS 서버에 주문 잔존 → 체결 = 고스트 매수
  - 이후 버그 수정 배포 → 컨테이너 재시작 → buy-executor 로그 소실
- **결과**: 27주 × 598,000원 매수, 현재가 577,000원 = -3.5% 손실

### 3. buy-scanner 전략 전수 진단

#### 30일 매수 실적 (STRONG_BULL 장)
| 전략 | 매수 건수 | 상태 |
|------|----------|------|
| MOMENTUM | 40건 | 추격매수 |
| GOLDEN_CROSS | 29건 | 추격매수 |
| MOMENTUM_CONTINUATION_BULL | 19건 | 추격매수 (+2% 이상 올라간 뒤 진입) |
| DIP_BUY | 1건 | 조정매수 (거의 미작동) |
| RECON_BULL_ENTRY | 0건 | RECON 티어 종목 없음 (사문화) |
| SHORT_TERM_HIGH_BREAKOUT | 0건 | 단일 1분봉 조건 과잉 |
| BULL_PULLBACK | 0건 | **일봉 패턴을 1분봉에 적용 (타임프레임 불일치)** |
| VCP_BREAKOUT | 0건 | **주봉 패턴을 20분에 적용 (타임프레임 불일치)** |
| INSTITUTIONAL_ENTRY | 0건 | **1분봉에서 Marubozu 불가능 (타임프레임 불일치)** |
| VOLUME_BREAKOUT_1MIN | - | config 비활성 (성과 -0.34%) |
| RSI_REBOUND | - | Bull에서 비활성 |
| BB_LOWER | - | Bull에서 비활성 |

#### 핵심 발견
1. **12개 전략 중 9개 활성, 실제 발동 3개** — 나머지 6개는 구조적 미작동
2. **3개 전략 타임프레임 불일치**: BULL_PULLBACK, VCP_BREAKOUT, INSTITUTIONAL_ENTRY는 일봉/주봉 패턴을 1분봉에 적용 → 설계 오류
3. **작동하는 3개 전략 모두 추격매수**: 이미 오른 종목만 뒤쫓음
4. **Scout 분석 무시**: Scout이 A등급으로 선정한 종목을 싸게 살 전략이 없음
5. **MOMENTUM_CONTINUATION에 상승률 상한 없음**: +2%든 +7%든 무조건 매수

#### 사용자 핵심 인사이트
> "watchlist에 있었는데 왜 7% 오를때까지 지켜만 보다가 그제서야 올라타느냐"

Scout이 종목 선정을 잘 하고 있는데, buy-scanner가 그 분석을 활용하지 못하고
가격이 크게 움직인 뒤에야 반응하는 구조적 문제.

## 다음 세션 TODO

### 매매 데이터 분석 + buy-scanner 개선안 설계/구현
1. **과거 매매 데이터 분석**
   - MOMENTUM/GOLDEN_CROSS/MOMENTUM_CONTINUATION 진입 시점 상승률별 D+1~D+5 수익률
   - 진입 시점 상승률 몇 %에서 손실로 전환되는지 변곡점 찾기
   - watchlist 등록 후 시점별(D+0, D+1, D+2...) 최적 진입 타이밍

2. **전략 구조 개편 설계**
   - Scout 고확신 종목 선제 진입 전략 (watchlist A등급 → 장 초반 적정가 매수)
   - MOMENTUM_CONTINUATION 상승률 상한 추가
   - 타임프레임 불일치 전략 3개 처리 (수정 or 제거)
   - RECON_BULL_ENTRY 사문화 조건 정리

3. **구현 및 테스트**

## 변경 파일
- `scripts/run_macro_council.py` — 섹터 모멘텀 헬퍼 + 컨텍스트 빌더 수정
- `tests/scripts/test_macro_council_pipeline.py` — 테스트 8개 추가 (39개 총)

## 커밋 상태
- development 브랜치, 미커밋 변경 2개 파일
- origin/development 대비 1 commit ahead (이전 세션 커밋)
