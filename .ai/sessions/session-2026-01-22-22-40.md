# Session Handoff: Redis Cache Trading Bug Fix

## 요약 (Summary)
Redis 캐시 기반 트레이딩 로직에서 **새 포지션(재매수) 시 이전 거래 데이터(High Watermark 등)가 초기화되지 않아 매도 시점이 왜곡되는 치명적 버그**를 수정했습니다.
`update_high_watermark` 함수에 자동 리셋 로직을 추가하고, 매수 완료 시점에 모든 트레이딩 상태를 일괄 초기화(`reset_trading_state_for_stock`)하도록 안전장치를 강화했습니다.

## 변경 사항 (Changes)
- `shared/redis_cache.py`:
    - `update_high_watermark`: 매수가 변경 감지 시 High Price 리셋 및 `force_update` 로직 적용.
    - `reset_trading_state_for_stock`: High Watermark, Scale-out Level, Profit Floor 등 잔여 상태 일괄 삭제 함수 추가.
- `services/buy-executor/executor.py`: DB에 매수 기록 후 `redis_cache.reset_trading_state_for_stock` 호출 추가.
- `tests/shared/test_redis_cache.py`: 새 포지션 감지 및 일괄 초기화 관련 Unit Test 추가.
- `scripts/verify_redis_fix.py`: 실제 Redis 환경에서 동작을 검증하기 위한 스크립트 작성.
- `docs/changelogs/CHANGELOG-2026-01.md`: 금일 작업 내역 업데이트.

## 다음 단계 (Next Steps)
- [ ] Jenkins 배포 후 실제 거래 로그 모니터링 (특히 재매수 종목).
- [ ] `verify_redis_fix.py`는 검증 완료되었으므로 추후 삭제 고려.
