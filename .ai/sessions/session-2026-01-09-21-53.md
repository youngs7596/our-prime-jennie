# Session Handoff: WebSocket E2E 테스트 환경 구축

## 요약 (Summary)
Mock WebSocket 서버를 구현하고 테스트 API를 추가하여 완전한 E2E 테스트 파이프라인을 구성했습니다.
curl 명령 한 번으로 매수 신호가 Mock 서버 → WebSocket → buy-scanner-mock → RabbitMQ까지 전달되는 것을 검증했습니다.

## 변경 사항 (Changes)

### Mock WebSocket 서버
- `docker/kis-mock/mock_server.py`: Flask-SocketIO 기반 WebSocket 기능 추가
  - `/api/trigger-buy-signal`: 매수 신호 직접 발행 API
  - `/api/trigger-price-burst`: 가격 버스트 발행 API (캔들 완성 시뮬레이션)
- `docker/kis-mock/Dockerfile`: `flask-socketio`, `python-socketio` 의존성 추가

### buy-scanner 서비스
- `services/buy-scanner/main.py`: Mock WebSocket 모드 지원 (`MOCK_SKIP_TIME_CHECK=true`)
  - `_start_mock_websocket_loop()`: Mock SocketIO 서버 연결 함수
  - `buy_signal` 이벤트 핸들러: 테스트 API에서 발행된 신호 직접 RabbitMQ 발행
- `services/buy-scanner/requirements.txt`: `python-socketio[client]` 의존성 추가

### Docker Compose
- `docker-compose.yml`: 
  - `buy-scanner-mock`: Mock WebSocket 환경변수 추가 (`USE_WEBSOCKET_MODE`, `MOCK_SKIP_TIME_CHECK`, `KIS_BASE_URL_MOCK`)
  - `buy-scanner` (Real): `USE_WEBSOCKET_MODE=true` 적용, PORT 중복 제거

### 테스트 파일
- `tests/integration/test_websocket_buy_flow.py`: WebSocket 기반 매수 흐름 E2E 테스트

## 다음 단계 (Next Steps)
- [ ] Real 모드 buy-scanner 재빌드 및 배포 (`docker compose --profile real build buy-scanner`)
- [ ] 장중 KIS WebSocket 연결 테스트
- [ ] 매수 신호 발생 및 buy-executor 연동 검증
