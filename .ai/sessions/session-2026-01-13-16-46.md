# Session Handoff: Airflow DAG Fixes & Stability

## 요약 (Summary)
Airflow DAG(`analyst_feedback_update`, `weekly_factor_analysis`)의 실패 원인을 분석하여 데이터 스키마 불일치(`KeyError`)와 DB 연결 객체 타입 불일치(`AttributeError`) 문제를 해결하고, Airflow 컨테이너의 권한 및 의존성 문제를 최종적으로 정리하여 안정적인 운영 환경을 구축했습니다.

## 변경 사항 (Changes)
- `scripts/update_analyst_feedback.py`: `LLMDecisionLedger` 모델에 존재하지 않는 `hybrid_score` 참조 제거 (KeyError 해결).
- `scripts/run_factor_analysis.py`: `database.get_db_connection()`(Raw DBAPI) 대신 `database.init_connection_pool()`(SQLAlchemy Engine)을 사용하여 `FactorAnalyzer` 호환성 확보 및 `conn.close()` 크래시 수정.
- `docker-compose.yml`: (이전 세션) Airflow 컨테이너에 `extra_hosts` 추가 및 `secrets.json` 권한 수정.
- `services/airflow/Dockerfile`: `python-dotenv`, `FinanceDataReader` 의존성 추가.

## 다음 단계 (Next Steps)
- [ ] Airflow DAG 전체(`daily_market_data_collector`, `analyst_feedback_update`, `weekly_factor_analysis`)가 스케줄에 따라 정상 실행되는지 모니터링.
- [ ] `weekly_factor_analysis` 실행 시 발생하는 SQLAlchemy 2.0 Warning(`pandas.to_sql` 등) 장기적으로 개선 검토.
