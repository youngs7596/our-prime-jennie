# Session Handoff: WebSocket Buy Scanner Implementation

## 요약 (Summary)
이번 세션에서는 기존 3분 주기 폴링 방식의 Buy Scanner 한계를 극복하기 위해 **WebSocket 기반 실시간 매수 신호 감지 시스템**을 구현했습니다. `Scout Job`이 선별한 Hot Watchlist를 Redis에 저장하고, `Price Monitor`가 이를 실시간으로 구독하여(OpportunityWatcher) 매수 기회를 즉각 포착하도록 파이프라인을 재설계했습니다. 또한 WebSocket 장애 시 폴링 모드로 전환하는 Fallback 로직과 시장 국면 변화에 따른 경량 재필터링 기능도 추가했습니다.

## 변경 사항 (Changes)
- **`services/price-monitor/opportunity_watcher.py` (New)**: `BarAggregator`(1분 캔들 집계) 및 `OpportunityWatcher`(Hot Watchlist 로드, 신호 감지, RabbitMQ 발행) 클래스 구현.
- **`services/price-monitor/monitor.py`**: `OpportunityWatcher` 통합 및 WebSocket 구독 로직에 Hot Watchlist 추가.
- **`services/scout-job/scout_cache.py`**: `save_hot_watchlist()` (Redis 버저닝 저장), `refilter_hot_watchlist_by_regime()` (경량 재필터링) 구현.
- **`services/buy-executor/executor.py`**: Realtime 소스(`opportunity_watcher`) 식별 시 LLM 스코어 검증 간소화(Fast Path) 및 오래된 점수(`llm_scored_at` > 24h)에 대한 감점(-10점) 로직 적용.
- **`services/buy-scanner/scanner.py`**: `HOT_WATCHLIST_ONLY_MODE` 설정 추가 (WebSocket 장애 시 Fallback용).
- **`tests/`**: `test_opportunity_watcher.py`, `test_hot_watchlist.py` 등 단위 테스트 파일 작성 (로컬 환경 문제로 Docker E2E 테스트로 검증 대체).

## 검증 결과 (Validation)
- **E2E Test**: Docker 컨테이너 재배포 후 `price-monitor` 로그 확인.
    - Hot Watchlist 로드 성공 (Redis 연동).
    - WebSocket 스트림에 Hot Watchlist 종목 정상 구독 확인.
    - 실시간 틱 데이터 처리 및 캔들 집계 시작 확인.

## 다음 단계 (Next Steps)
- **Silent Stall 감지**: WebSocket 연결은 살아있으나 데이터가 들어오지 않는 경우를 감지하여 자동 재연결하는 로직 구현 필요.
- **모니터링 강화**: `OpportunityWatcher`의 메트릭(`get_metrics`)을 대시보드나 프로메테우스로 노출하여 실시간 상태 시각화.
- **실전 매매 모니터링**: 실제 장중 매수 신호 발생부터 체결까지의 전체 사이클 모니터링 및 튜닝(슬리피지, 타이밍 등).
