# Session Handoff: Macro Council Integration Bug Fix

## 요약 (Summary)
이번 세션에서는 **Macro Council의 분석 결과가 실제 트레이딩 시스템(Buy Executor)에 반영되는지 분석**했습니다. 분석 결과, `DailyMacroInsight`가 Scout 단계에서는 사용되지만, **Buy Executor로 전달되는 메시지 페이로드에 리스크 설정(`risk_setting`)이 누락**되는 치명적인 버그를 발견했습니다.

이를 위해 `OpportunityWatcher.publish_signal` 메서드를 수정하여 `position_multiplier`와 `stop_loss_multiplier`를 포함한 `risk_setting`을 명시적으로 주입하도록 조치했습니다. 검증 스크립트(`test_risk_injection.py`)를 작성했으나, 임포트 경로 문제로 실행 검증은 다음 세션으로 연기되었습니다.

## 변경 사항 (Changes)
- `shared/macro_data/clients/pykrx_client.py`: 미래 타임스탬프 문제 및 데이터 캐싱 로직 수정
- `services/buy-scanner/opportunity_watcher.py`: `publish_signal` 메서드에서 RabbitMQ 페이로드에 `risk_setting` 주입 로직 추가
- `docs/changelogs/CHANGELOG-2026-02.md`: 버그 수정 내역 업데이트
- `services/buy-scanner/test_risk_injection.py`: 검증 스크립트 작성 (실행 실패, 수정 필요)

## 다음 단계 (Next Steps)
- [ ] `services/buy-scanner/test_risk_injection.py`의 임포트 에러 수정 (`OpportunityWatcher` -> `BuyOpportunityWatcher` 클래스명 확인) 및 검증 실행
- [ ] `BuyExecutor`가 수신한 메시지에서 `risk_setting`을 올바르게 파싱하여 포지션 사이징에 반영하는지 로그 확인 (Dry Run)
- [ ] Macro Council의 `stop_loss_multiplier`가 실제 주문의 초기 손절가에 반영되는지 확인
