# Session 2026-02-14 22:00 — Co-Authored-By 없는 커밋 전수 점검 및 Gemini 잔존 코드 정리

## 요약 (Summary)

2026-01 이후 424개 커밋 중 Co-Authored-By 없는 코드 변경 152개를 전수 분석.
Gemini가 Claude 대체 시 작성한 "회피 코드" 패턴(except:pass, volume=0 하드코딩, sys.path hack 등)을 식별하고 수정 완료.

## 분석 범위

- **총 커밋**: 424개 (2026-01 이후)
- **Co-Authored-By 없는 코드 변경**: 152개
- **위험 구간 집중 분석**: 1/28 Emergency Pipeline (4건), 2/4 ChromaDB 마이그레이션 (3건)

## 발견 및 수정 사항

### HIGH 위험 (6건 → 수정 완료)

| # | 파일 | 패턴 | 수정 내용 |
|---|------|------|----------|
| 1 | `services/kis-gateway/main.py:252` | `volume=0` 기본값 | volume=0 수신 시 경고 로그 추가 |
| 2 | `shared/kis/stream_consumer.py:154` | vol 필드 누락 | vol 필드 None 시 경고 로그 추가 |
| 3 | `shared/kis/websocket.py:157` | volume 필드 부족 | fields<10 시 경고 로그 추가 |
| 4 | `shared/hybrid_scoring/quant_scorer.py:1423` | `except Exception: pass` | 수급 흐름 반전 계산 경고 로그 |
| 5 | `shared/hybrid_scoring/quant_scorer.py:1465` | `except Exception: pass` | 스마트머니 동시매수 경고 로그 |
| 6 | `shared/kis/market_data.py:283-286` | OHLCV `or 0` | None이면 해당 바 skip (지표 왜곡 방지) |

### MEDIUM 위험 (4건 → 수정 완료)

| # | 파일 | 패턴 | 수정 내용 |
|---|------|------|----------|
| 7 | `services/news-analyzer/analyzer.py:290-296` | `except: pass` + 주석 독백 | Normal Flow 폴백 추가 |
| 8 | `shared/database/market.py:462-495` | Raw SQL 이중 쓰기 | 주석 개선 (factor_analyzer 의존성 명시) |
| 9 | `services/price-monitor/monitor.py:17-19,393` | sys.path hack + hasattr | sys.path 제거, __init__에서 정상 초기화 |
| 10 | `shared/crawlers/naver.py` (6곳) | bare `except:` | 구체적 예외 타입으로 변경 |

### 추가 수정

| 파일 | 패턴 | 수정 내용 |
|------|------|----------|
| `services/price-monitor/monitor.py:357` | 매크로 손절 배율 `except: pass` | 경고 로그 추가 |
| `shared/kis/market_data.py:276` | bare `except:` | `except (ValueError, IndexError)` |

### Cleanup (데드 코드 3건 삭제)

| 파일 | 이유 |
|------|------|
| `scripts/test_embedding_quality.py` | Ollama 전용, vLLM 전환 후 무용 |
| `scripts/smart_build.py` | Jenkinsfile에서 미사용, SERVICE_MAP 구식 |
| `services/buy-scanner/test_risk_injection.py` | tests/ 아닌 서비스 디렉토리에 배치 |

## 이미 수정 완료였던 것

- GOLDEN_CROSS 사문화 → `dafd1a5`에서 volume 파이프라인 복구됨
- ollama-gateway 구문 오류 → 서비스 전체 제거로 해결
- chromadb 잔여 import → 후속 커밋에서 삭제
- bare except (market.py:476) → 이미 구체적 예외 타입으로 수정됨

## 변경 사항 (Changes)

- `services/kis-gateway/main.py`: volume=0 경고 로그
- `shared/kis/stream_consumer.py`: vol 필드 누락 경고 로그
- `shared/kis/websocket.py`: volume 필드 미수신 경고 로그
- `shared/hybrid_scoring/quant_scorer.py`: 수급 서브팩터 except:pass → 경고 로그 (2곳)
- `services/price-monitor/monitor.py`: sys.path hack 제거, GapDownSafety __init__ 초기화, 매크로 손절 배율 경고 로그
- `shared/kis/market_data.py`: OHLCV or 0 → None이면 skip, bare except 수정
- `services/news-analyzer/analyzer.py`: Fast Track except:pass → Normal Flow 폴백
- `shared/database/market.py`: Raw SQL 이중 쓰기 주석 개선
- `shared/crawlers/naver.py`: bare except 6곳 → (ValueError, IndexError)
- 삭제: `scripts/test_embedding_quality.py`, `scripts/smart_build.py`, `services/buy-scanner/test_risk_injection.py`

## 테스트 결과

- shared: **1220 passed**, 1 skipped
- services: **250 passed**
- 총 **1470 passed**, 0 failures

## 시스템 상태

- 브랜치: `development`
- 변경: 8개 수정 + 3개 삭제 = 11개 파일

## 다음 세션 TODO

- Gemini 작성 커밋 중 남은 LOW 위험 항목들 (scripts/ bare except 등) — 긴급하지 않음
- 프로덕션 배포 후 volume 경고 로그 모니터링
- STOCK_NEWS_SENTIMENT ↔ NEWS_SENTIMENT 테이블 통합 검토 (장기)
