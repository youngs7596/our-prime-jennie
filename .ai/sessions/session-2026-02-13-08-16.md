# Session Handoff: 2026-02-13 08:16

## 세션 주제
RabbitMQ 레거시 정리: Dashboard UI + E2E 테스트 fixtures + 테스트 격리 수정

## 배경
- 2026-02-12 세션에서 RabbitMQ → Redis Streams 인프라 전환 완료
- Jenkins 빌드/배포 후 프로덕션 정상 동작 확인 (29개 컨테이너 all healthy)
- 남은 레거시 정리 작업 3건 수행

## 변경 내역

### 1. Dashboard 프론트엔드 RabbitMQ UI 제거
- `System.tsx`: RabbitMQ 쿼리 훅/큐 목록 카드 제거, "Redis Streams" 정보 카드로 교체
- `api.ts`: `systemApi.getRabbitMQ()` 삭제
- `PrimeJennieArchitecture.tsx`: RabbitMQ 노드 → Redis Streams 노드, 트레이딩 플로우 업데이트, Tech Stack 문구 업데이트
- `system.py`: `/rabbitmq` 레거시 엔드포인트 삭제

### 2. E2E 테스트 fixtures: RabbitMQ → Redis Streams
- **신규**: `tests/e2e/fixtures/stream_fixtures.py` — `MockStreamPublisher`, `MockStreamConsumer`, `StreamTestBridge`, `StreamNames`
- **삭제**: `tests/e2e/fixtures/rabbitmq_fixtures.py` (437줄)
- `conftest.py`: import/fixture 이름 전환 (RabbitMQTestBridge → StreamTestBridge)
- `test_full_cycle.py`: QueueNames → StreamNames
- `test_error_handling.py`: 클래스/설명 이름 업데이트
- `__init__.py`: export 업데이트
- E2E 테스트 99/102 passed (3건 실패는 기존 stale score 기대값 불일치, 무관)

### 3. macro_council 테스트 격리 문제 해결
- **근본 원인**: `scripts/__init__.py` 누락 → services 테스트와 함께 실행 시 namespace package 해석 실패
- **수정**:
  - `scripts/__init__.py` 추가 (빈 패키지 초기화)
  - `test_macro_council_pipeline.py`: `sys.path.insert` 중복 삽입 방지 가드 추가
  - `tests/conftest.py`: `reset_singletons()`에서 `LLMFactory._providers = {}` + `ModelStateManager._instance = None` 올바르게 리셋
- **결과**: 통합 실행 1375 passed, 0 failed (이전: 23 failed)

### 4. 이전 세션 누락 파일 포함
- `job-worker/requirements.txt`: `langchain-ollama` 삭제 (Ollama Gateway 제거 후속)
- `scout-job/requirements.txt`: `langchain-ollama` → `langchain-openai` 전환
- `scout-job/scout_universe.py`: Pre-market 0% 감지 → DB 전일 대비 수익률 대체 로직

## 수정 파일 목록

### 신규 (2개)
- `scripts/__init__.py`
- `tests/e2e/fixtures/stream_fixtures.py`

### 수정 (11개)
- `services/dashboard/backend/routers/system.py`
- `services/dashboard/frontend/src/components/PrimeJennieArchitecture.tsx`
- `services/dashboard/frontend/src/lib/api.ts`
- `services/dashboard/frontend/src/pages/System.tsx`
- `services/job-worker/requirements.txt`
- `services/scout-job/requirements.txt`
- `services/scout-job/scout_universe.py`
- `tests/conftest.py`
- `tests/e2e/conftest.py`
- `tests/e2e/test_error_handling.py`
- `tests/e2e/test_full_cycle.py`
- `tests/scripts/test_macro_council_pipeline.py`

### 삭제 (1개)
- `tests/e2e/fixtures/rabbitmq_fixtures.py`

## 테스트 결과
- `tests/shared/` + `tests/services/` + `tests/integration/` + `tests/scripts/`: **1375 passed, 2 skipped, 0 failed**
- `tests/e2e/` (마커 포함): 99 passed, 3 failed (기존 stale score 불일치)

## 다음 단계 (TODO)
- [ ] E2E stale score 테스트 3건 기대값 수정 (0.5→0.3, 비즈니스 로직 변경 반영)
- [ ] Dashboard README.md RabbitMQ 참조 업데이트
- [ ] `tests/e2e/README.md` RabbitMQ 참조 업데이트
