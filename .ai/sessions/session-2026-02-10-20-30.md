# Session Handoff: Portfolio Guard Layer 2

## 요약 (Summary)
포트폴리오 수준 리스크 관리 모듈(Portfolio Guard Layer 2) 구현. 2/9~2/10 거래 분석에서 금융 섹터 4종목 집중(28%), 현금 48%→8% 급감 등 포트폴리오 구조 리스크 확인 → 3현자 만장일치 승인 후 구현.

## 변경 사항 (Changes)

### Portfolio Guard Layer 2
- **신규 `shared/portfolio_guard.py`**: PortfolioGuard 클래스
  - `check_sector_stock_count()`: 동일 대분류(14개) MAX_SECTOR_STOCKS(3) 초과 방지
  - `check_cash_floor()`: 국면별 현금 하한선 (STRONG_BULL:5%, BULL:10%, SIDEWAYS:15%, BEAR:25%)
  - `check_all()`: 순차 실행 (fail-fast) + shadow mode (PORTFOLIO_GUARD_ENABLED=false)
- **`shared/settings/registry.py`**: 7개 설정 추가 (PORTFOLIO_GUARD_ENABLED, MAX_SECTOR_STOCKS, CASH_FLOOR_*_PCT)
- **`services/buy-executor/executor.py`**: PortfolioGuard import + `__init__` 초기화 + `process_buy_signal()` 내 체크 삽입 (포지션 사이징 후, 분산 검증 전)
- **`infrastructure/env-vars-wsl.yaml`**: 7개 환경변수 기본값 추가
- **신규 `tests/shared/test_portfolio_guard.py`**: 24개 유닛 테스트 (섹터 8 + 현금 10 + 통합 6)
- **`tests/services/buy-executor/test_buy_executor.py`**: 기존 DRY_RUN 테스트에 PortfolioGuard mock 추가 + 3개 통합 테스트 추가

### 커밋
- `a2ad360` feat: Portfolio Guard Layer 2 — 섹터 종목 수 제한 + 국면별 현금 하한선

## 테스트 결과
- shared: 1140 passed (24개 신규 포함)
- buy-executor: 26 passed (3개 신규 포함)
- 기존 테스트 전체 통과 (회귀 없음)

## 미니서버 이전 검토
- **Minisforum MS-01** (i9-12900, DDR5 32GB, USB4 eGPU RTX 3090)
- 전체 컨테이너 RAM ~11.4 GiB / 32 GiB → 여유 충분
- Native Ubuntu > WSL2 (Hyper-V 오버헤드 제거, Docker 네이티브, 파일 I/O 향상)
- 배포: 현재 PC(Jenkins) → Private Docker Registry → 미니서버 pull 방식 계획
- 미니서버 도착 후 구체적 셋업 진행 예정

## 다음 단계 (Next Steps)
- [ ] Jenkins 빌드 #결과 확인 (Portfolio Guard 배포)
- [ ] 1~2주 shadow mode 로그 모니터링 → 필요시 MAX_SECTOR_STOCKS/CASH_FLOOR 튜닝
- [ ] 미니서버(MS-01) 도착 후 이전 작업 (Private Registry + 데이터 마이그레이션)

## 롤백
- `PORTFOLIO_GUARD_ENABLED=false` → 즉시 shadow mode 전환 (코드 변경 없이)
- 기존 `DiversificationChecker`(비율 30%) + `CASH_KEEP_PCT`(소프트) 변경 없음 → 롤백 영향 제로
