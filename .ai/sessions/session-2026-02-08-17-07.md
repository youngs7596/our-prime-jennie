# Session Handoff: 필터 체인 재배치 + 대시보드 개선 + E2E 검증 테스트

## 요약 (Summary)
필터 체인 재배치(3현자 리뷰 반영)를 구현하고, E2E 테스트로 검증한 세션.
Executor Hard Floor, Stale Score 배율 축소, Shadow Mode 로깅 등 핵심 변경사항을 E2E 12개 + 기존 수정 포함 총 72개 E2E 테스트로 검증 완료.
Jenkins 빌드 #322 SUCCESS, 전체 서비스 정상 구동 확인.

## 변경 사항 (Changes)

### 필터 체인 재배치 (이전 세션에서 구현, 이번 세션에서 E2E 검증)
- **services/buy-executor/executor.py**: Hard Floor(score<40 거부), Stale Score 배율 축소(2영업일:0.5, 3영업일+:0.3), Shadow Mode 로깅, MIN_LLM_SCORE 이중 체크 제거
- **services/buy-scanner/opportunity_watcher.py**: `_check_micro_timing()` 추가 (Executor에서 이동)
- **services/scout-job/scout.py**: `recon_score_by_regime` 커트라인 제거, `MAX_WATCHLIST_SIZE` 도입
- **services/scout-job/scout_pipeline.py**: 정리/단순화
- **shared/watchlist.py**: `refilter_hot_watchlist_by_regime()` 단순화
- **shared/settings/registry.py**: MIN_LLM_SCORE 관련 설정 3개 삭제
- **docker-compose.yml**: MAX_WATCHLIST_SIZE=20 추가
- **infrastructure/env-vars-wsl.yaml**: MIN_LLM_SCORE 2개 삭제, MAX_WATCHLIST_SIZE=20 추가

### 대시보드 개선
- **services/dashboard/frontend**: Login.tsx 삭제, Overview/Scout/System/Sidebar 개선
- **services/dashboard/backend**: main.py, performance.py, portfolio.py 개선

### E2E 테스트 (이번 세션 핵심)
- **tests/e2e/test_buy_flow.py**: `test_low_llm_score_skipped` → `test_hard_floor_rejects_low_score` (llm_score=45→35, hard floor 기반 검증)
- **tests/e2e/conftest.py**: `create_scan_result()`에 `llm_scored_at` 파라미터 추가
- **tests/e2e/test_filter_chain.py** (신규): 12개 E2E 테스트
  - `TestHardFloor` (3개): 경계값 30/40/55 검증
  - `TestStaleScoreE2E` (4개): 당일/2영업일/3영업일/금→월 주말 처리
  - `TestShadowModeE2E` (2개): 기존 기준 차단→shadow 로그, 고점수→shadow 없음
  - `TestFilterChainIntegration` (3개): 통합 흐름 검증

### 문서
- **docs/filter-chain-reorganization-review.md** (신규): 3현자 리뷰 결과
- **DASHBOARD_IMPROVEMENT_PLAN.md** (신규): 대시보드 개선 계획
- **scripts/analyze_filter_chain.py** (신규): 필터 체인 분석 스크립트

## 검증 결과
- E2E 테스트: **72 passed** (기존 60 + 신규 12)
- buy-executor 단위: **23 passed**
- shared 단위: **1113 passed**, 1 skipped
- Jenkins 빌드 #322: **SUCCESS** (1304 passed, 1 skipped)
- 전체 서비스: **healthy** (30개 컨테이너, 에러 로그 없음)

## Git 동기화
- `origin/development`: 595f198 push 완료
- `origin/main`: 595f198 push 완료
- `public/development`: 595f198 push 완료
- `public/main`: 595f198 push 완료

## 다음 단계 (Next Steps)
- [ ] Shadow Mode 로그 1~2주 모니터링 후 제거 여부 결정
- [ ] Stale Score 실전 성과 추적 (`[STALE_ENTRY]` 태그 기반)
- [ ] Scanner `_check_micro_timing()` 실전 동작 확인
- [ ] v2 실전 IC 모니터링 (진행 중)
- [ ] `python scripts/collect_foreign_holding_ratio.py --days 30` (DB 백필, 미완료)

## Context for Next Session
- 필터 체인 재배치 구현 + E2E 검증 완료, 프로덕션 배포됨
- Shadow Mode는 1~2주 한정 추적용 → 데이터 축적 후 제거 가능
- 대시보드 프론트엔드 변경 포함 (Login.tsx 삭제, Overview/Scout 개선)
- 핵심 파일: `executor.py`, `opportunity_watcher.py`, `test_filter_chain.py`
