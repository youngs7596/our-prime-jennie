# Session Handoff: Real Scout Pipeline Backfill Implementation

## 요약 (Summary)
실제 Scout 서비스 파이프라인(`Hunter` -> `Debate` -> `Judge`)을 그대로 활용하여 과거 데이터를 백필할 수 있는 `utilities/backfill_scout_real.py` 스크립트를 구현하고 검증했습니다. **Time Machine Monkey Patching** 기법을 사용하여 시스템 시간을 속이는 대신 데이터 제공자(Price, News, Universe)가 과거 데이터를 반환하도록 조작했으며, **Local LLM Gateway**를 강제하여 비용 없이 대량의 백필이 가능하도록 구성했습니다.

## 변경 사항 (Changes)
- `utilities/backfill_scout_real.py`: [NEW] 백필 메인 스크립트.
    - `MockKISClient`: DB(`STOCK_DAILY_PRICES_3Y`, `STOCK_FUNDAMENTALS`) 기반 스냅샷 및 투자자 동향 조회 구현.
    - `Monkey Patching`: `shared.database`, `scout_universe`, `JennieBrain` 등을 런타임에 패치하여 과거 시점 시뮬레이션.
    - `Local Gateway Force`: `_force_local_llm_gateway`함수로 모든 LLM Tier를 Local Ollama로 강제 전환.
- `shared/database/market.py`: [MODIFY] `get_daily_prices`에 `end_date` 파라미터 추가 (Time Machine 지원).
- `CHANGELOG.md`: [UPDATE] 백필 기능 구현 및 관련 Fix 사항 기록.
- `LICENSE`: [CREATE] Apache License 2.0 추가 (프로젝트 배포 준비).
- `task.md`, `implementation_plan.md`, `walkthrough.md`: [UPDATE] 작업 진행 상황 및 검증 결과 문서화.

## 주요 이슈 및 해결 (Issues & Resolutions)
1.  **ProgrammingError (Unknown Column)**: `STOCK_FUNDAMENTALS` 테이블에 `SALES_GROWTH` 등이 없어 발생 -> `MockKISClient` 쿼리 수정 및 하드코딩 기본값(`0.0`) 처리.
2.  **NameError (Monkey Patching)**: 패치된 `JennieBrain` 메서드 내에서 `LLMTier`, `build_judge_prompt_v5` 등 import 누락 -> 함수 내 지역 import로 해결.
3.  **AttributeError (Prompt Builder)**: `scout` 모듈에서 `build_hunter_prompt_v5`를 찾지 못함 -> `shared.llm_prompts`에서 직접 import.
4.  **Local LLM Integration**: Ollama Gateway 연동 확인 및 `gpt-oss:20b` 모델 정상 동작 검증.

## 다음 단계 (Next Steps)
- [ ] **대량 백필 실행**: `nohup python3 utilities/backfill_scout_real.py --start 2025-07-01 --end 2026-01-09 &` 명령어로 지난 6개월치 데이터 백필 수행.
- [ ] **Judge 모델 개선**: 백필된 `WATCHLIST_HISTORY` 데이터를 분석하여 Judge의 승률 예측 정확도 검증 및 프롬프트 튜닝.
- [ ] **대시보드 통합**: 백필 진행률이나 결과를 대시보드에서 시각화하는 기능 고려.
